#!/usr/bin/env sh

set -e

SCRIPT=$(readlink -f "$0")
DIR=$(dirname "$SCRIPT")

deploy_stack () {
  STACK_NAME="$1"
  shift
  EXTRA_ARGS="$@"

  if [ -f "$DIR/../$STACK_NAME/.env" ]; then
    set -a
    . "$DIR/../$STACK_NAME/.env"
    set +a
  fi

  docker stack deploy $EXTRA_ARGS --compose-file "$DIR/../$STACK_NAME/docker-compose.yaml" $STACK_NAME
}

deploy_stack nginx-proxy
deploy_stack hello-world
deploy_stack dashboard