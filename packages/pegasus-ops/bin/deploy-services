#!/usr/bin/env sh

SCRIPT=$(readlink -f "$0")
DIR=$(dirname "$SCRIPT")

deploy_stack () {
  STACK_NAME="$1"
  shift
  EXTRA_ARGS="$@"

  # npx @pegasus-ops/config-version-helper "$DIR/../deployments/$STACK_NAME/docker-compose.yaml"
  # set -a
  # . "$DIR/../deployments/$STACK_NAME/config-versions.env"
  # set +a

  docker stack deploy $EXTRA_ARGS --compose-file "$DIR/../$STACK_NAME/docker-compose.yaml" $STACK_NAME
}

set -e
set -x

deploy_stack nginx-proxy
deploy_stack hello-world
deploy_stack dashboard